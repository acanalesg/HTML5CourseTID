<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">

    <script>
      var ele = document.createElement('script');
      ele.src = 'promise.js?t=' + Date.now();
      var loaded = false;
      ele.onload = function() {
        loaded = true;
        var ev = new CustomEvent('script_loaded');
        document.dispatchEvent(ev);
      }
      document.head.appendChild(ele);

      function doRun() {
        Rest.load('http://jsbin.com/canvas/73/source').done(function(response) {
          window.console.log('Response: ', response);
        });
      }

      function run() {
        if(loaded) {
          doRun();
        }
        else {
          document.addEventListener('script_loaded', function scrl() {
            document.removeEventListener('script_loaded', scrl);
            doRun();
          });
        }
/*
        Rest.load('').then(function(response) {
          window.console.log('Another Response: ', response);
          return Rest.load('');
        }).done(function(response) {
          window.console.log('And now done', response);
        });

        Rest.load('').then(function(response) {
          window.console.log('Third Response', response);
          return Rest.load('');
        }).then(function(response) {
          window.console.log('Second of the third response', response);
          return Rest.load('');
        }).done(function(response) {
          window.console.log('And now done', response);
        }); */
      }
    </script>
  </head>

  <body>
    <p id="result"></p>

    <button id="openDB" type=button onclick="run()">Run</button>
  </body>
</html>
